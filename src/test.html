<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script>
    import wepy from 'wepy'
    import api from '@utils/api'

    export default class User extends wepy.page {
      config = {
        navigationBarTitleText: '我的'
      }
      data = {
      // 标记是否登录
        // loggedIn: false,
        // 用户信息
        user: null
      }
      async onShow() {
        //每次打开页面，获取当前用户信息
        this.user = await this.$parent.getCurrentUser()
        this.$apply()
      // 获取缓存中的access_token
        // let accessToken = wepy.getStorageSync('access_token')

      // token存在则说明已登录
        // if (accessToken) {
          // 测试authRequset接口
          // let userResponse = await api.authRequest('user')
          // this.userInfo = userResponse.data
          // this.loggedIn = true
          // this.$apply()
        // }
      }
      methods = {
      // 退出
        async logout(e) {
          try {
            let logoutResponse = await api.logout()

                // 退出成功清除消息
            if (logoutResponse.statusCode === 204) {
              // this.loggedIn = false
              this.user = null
              this.$apply()
            }
          } catch (e) {
            console.log(e)
            wepy.showModal({
              title: '提示',
              content: '服务器错误，请联系管理员'
            })
          }
        }
      }
    }
</script>

</body>
</html>